<!doctype html>
<html>
<head>
      <meta charset='utf-8' />
      <title>Great Discoveries in Archaeology </title>
      <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
      <script src='//api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
      <link href='//api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
      <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:0; bottom:0; width:100%; }
	      .leaflet-popup-content-wrapper {background-color: #f7f1ef; border: dashed; opacity=25} 
      </style>
</head>
      <body>
            <style>
		    #ritual-button {
		    	background: #FF5516
		    }
		    #settlement-button {
		    	background: #10BB6D
		    }
		    #architecture-button {
		    	background: #1971B0
		    }
                  #menu {
                        position: absolute; 
                        background: #fff;
                        padding: 10px;
                        font-family: 'Open Sans', sans-serif;
                  }
		    #menu {
        background: #f7f1ef;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        color: #404040;
    }

    #menu a.active {
        color: #ffffff;
    }
            </style>
	      <nav id="menu"></nav>
            <div id='map'></div>
            <script>
		    function classifyCategories(categoryString) {
			    return categoryString;
		    }
		    L.mapbox.accessToken = 'pk.eyJ1IjoibWljaGFlbG5ldCIsImEiOiItbWFqc3BvIn0.iuqIsFSNd5Ut-5_1W4RR_g';
                  var map = L.mapbox.map('map').setView([26.824071, -24.785156], 5);
                  L.mapbox.styleLayer('mapbox://styles/michaelnet/ciutulpjz00152ipqoggp1xrl').addTo(map);
                  var myLayer = L.mapbox.featureLayer().addTo(map);
		    var toggleableLayerIds = [ 'architecture', 'settlement', 'ritual' ];
		    for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
			    if (id === 'settlement') {
				    link.id = 'settlement-button';
			    }
			    else if (id === 'architecture') {
				    link.id = 'architecture-button';
			    }
			    else {
				    link.id = 'ritual-button';
			    }
    link.className = 'active';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
                  var places = [{
	"name": "Shanxi",
	"description": "Ancient town in China",
	"latitude": 37.2426,
	"longitude": 111.8569,
	"category": "settlement"
}, {
	"name": "Turpan",
	"description": "Ancient site in China",
	"latitude": 42.9477,
	"longitude": 89.1789,
	"category": "settlement"
}, {
	"name": "Xi'an",
	"description": "Home of the terra cotta soldiers",
	"latitude": 34.3416,
	"longitude": 108.9398,
	"category": "ritual"
}, {
	"name": "Ajanta Caves",
	"description": "Caves in India",
	"latitude": 20.5519,
	"longitude": 75.7033,
	"category": "architecture"
}, {
	"name": "Angkor Thom",
	"description": "Cambodia",
	"latitude": 13.4412,
	"longitude": 103.8590,
	"category": "architecture"
}, {
	"name": "Angkor Wat",
	"description": "Cambodia",
	"latitude": 13.4125,
	"longitude": 103.8670,
	"category": "architecture"
}, {
	"name": "Harrapa",
	"description": "Bad ass site in India.",
	"latitude": 30.6110,
	"longitude": 72.8929,
	"category": "architecture"
}, {
	"name": "Mount Sandel",
	"description": "Ireland",
	"latitude": 53.004620,
	"longitude": -3.940245,
	"category": "ritual"
}, {
	"name": "Oseberg",
	"description": "Viking burial site",
	"latitude": 53.142359,
	"longitude": -4.154067,
	"category": "ritual"
}, {
	"name": "Star Carr",
	"description": "Antler hats",
	"latitude": 53.281471,
	"longitude": -3.830214,
	"category": "ritual"
}, {
	"name": "Sutton Hoo",
	"description": "viking stuff",
	"latitude": 53.139107,
	"longitude": -4.276887,
	"category": "ritual"
}, {
	"name": "Skuldelev",
	"alt": " Anglicized as Dinorwyc",
	"description": "more viking stuff",
	"latitude": 53.134038,
	"longitude": -4.113916,
	"category": "ritual"
}, {
	"name": "Delphi",
	"description": "Greek oracle",
	"latitude": 53.232973,
	"longitude": -4.110179,
	"category": "ritual"
}, {
	"name": "Gobekli Tepe",
	"description": "Oldest temple in the world",
	"latitude": 52.998346,
	"longitude": -3.944913,
	"category": "ritual"
}, {
	"name": "L'Anse aux Meadows",
	"description": "EArly viking settlement in the americas",
	"latitude": 53.018578,
	"longitude": -4.081890,
	"category": "settlement"
}, {
	"name": "Cakokia Mounds",
	"description": "Giant mississippian town",
	"latitude": 52.994605,
	"longitude": -3.938312,
	"category": "architecture"
}, {
	"name": "Casa Grande",
	"description": "Casas Grande",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Crow Canyon",
	"description": "Awesome site in early america",
	"latitude": 53.057526,
	"longitude": -4.222792,
	"url": "http://www.nantlle.com/history-nantlle.htm",
	"category": "settlement"
}, {
	"name": "Lehner Mammoth-Kill Site",
	"description": "early big game hunting",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Pueblo Grande",
	"description": "large houses",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Calakmul",
	"description": "mayan site",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Tenochtitlan",
	"description": "modern day Mexico city",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Chichen Itza",
	"description": "Mayan Temple Complex",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"	
}, {
	"name": "Chan Chan",
	"description": "in south america",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}, {
	"name": "Nazca Lines",
	"description": "cool lines in Peru",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "architecture"
}];
                  var thesePlacesGeoJSON = [];
                  function getIconFromCategory (categoryString) {
                        switch (categoryString) {
                              case 'settlement':
                                    return '/Great-Discoveries/settlement.svg'
                              case 'architecture':
                                    return '/Great-Discoveries/architecture.svg'
                              case 'ritual':
                                    return '/Great-Discoveries/ritual.svg'
                              default:
                                    return 'bar'
                        }
                  };
                  function onEachFeature(feature, layer) { 
                        if (feature.properties && feature.properties.popupContent) { 
                              layer.bindPopup(feature.properties.popupContent); 
                        } 
                  };
                  for (var i = 0; i < places.length; i++ ) {
                              var place = places[i];
                              thisPlaceGeoJSON = {
                                    type: 'Feature',
                                    geometry: {
                                          type: 'Point',
                                          coordinates: [
                                                place.longitude, 
                                                place.latitude
                                          ]
                                    },
                                    properties: {
					    href: place.url,
					    title: place.name,
					    description: place.description,
					    icon: {
						    iconUrl: getIconFromCategory(place.category),
						    iconSize: [50, 50],
                                                iconAnchor: [25, 25],
                                                popupAnchor: [0, -25],
                                                className: classifyCategories(place.category)
                                          },
                                          popupContent: place.description
                                    }
                              }
                        thesePlacesGeoJSON.push(thisPlaceGeoJSON);
                  }
//                   var xhr = new XMLHttpRequest();
//                   xhr.onreadystatechange = function() {
//                         var places = JSON.parse(this.responseText);
//                         for (var i = 0; i < places.length; i++ ) {
//                               var place = places[i];
//                               thisPlaceGeoJSON = {
//                                     title: place.name,
//                                     description: place.description,
//                                     type: 'Feature',
//                                     geometry: {
//                                           type: 'Point',
//                                           coordinates: [
//                                                 place.longitude, 
//                                                 place.latitude
//                                           ]
//                                     },
//                                     properties: {
//                                           icon: {
//                                                 iconUrl: getIconFromCategory(place.category),
//                                                 iconSize: [50, 50],
//                                                 iconAnchor: [25, 25],
//                                                 popupAnchor: [0, -25],
//                                                 className: 'place'
//                                           },
//                                           popupContent: place.description
//                                     }
//                               }
//                               thesePlacesGeoJSON.push(thisPlaceGeoJSON);
//                         }
//                   };
//                   xhr.open("GET", "https://mappingmemory.github.io/UK/places.json");
//                   xhr.send();
                  myLayer.on('layeradd', function(e) {
                        var marker = e.layer;
                        var feature = marker.feature;
                        var content = '<h2>' + feature.properties.title + '</h2><p>' + feature.properties.description + '</p><p>For more information visit <a href="' + feature.properties.href + '">here.</a>';
                        marker.bindPopup(content);
                        marker.setIcon(L.icon(feature.properties.icon));
                        
                  });
                  myLayer.setGeoJSON(thesePlacesGeoJSON, { 
                                    onEachFeature: onEachFeature 
                              }).addTo(map);
                  setTimeout(function() {
                        myLayer.setGeoJSON(thesePlacesGeoJSON);
                  }, 500)
</script>
</body>
</html>
