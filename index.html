<!doctype html>
<html>
<head>
      <meta charset='utf-8' />
      <title>Great Discoveries in Archaeology </title>
      <meta name='viewport' content='initial-scale=2,maximum-scale=2,user-scalable=no' />
      <script src='//api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
      <link href='//api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
      <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:3; bottom:3; width:100%; }
	      .leaflet-popup-content-wrapper {background-color: #f7f1ef; border: dashed; opacity=25} 
      </style>
</head>
      <body>
            <style>
		    #labor-button {
		    	background: #FF5516
		    }
		    #wealth-button {
		    	background: #10BB6D
		    }
		    #community-button {
		    	background: #1971B0
		    }
                  #menu {
                        position: absolute; 
                        background: #fff;
                        padding: 10px;
                        font-family: 'Open Sans', sans-serif;
                  }
		    #menu {
        background: #f7f1ef;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        color: #404040;
    }

    #menu a.active {
        color: #ffffff;
    }
            </style>
	      <nav id="menu"></nav>
            <div id='map'></div>
            <script>
		    function classifyCategories(categoryString) {
			    return categoryString;
		    }
		    L.mapbox.accessToken = 'pk.eyJ1IjoibWljaGFlbG5ldCIsImEiOiItbWFqc3BvIn0.iuqIsFSNd5Ut-5_1W4RR_g';
                  var map = L.mapbox.map('map').setView([53.105160, -4.006747], 9);
                  L.mapbox.styleLayer('mapbox://styles/michaelnet/ciutulpjz00152ipqoggp1xrl').addTo(map);
                  var myLayer = L.mapbox.featureLayer().addTo(map);
		    var toggleableLayerIds = [ 'community', 'wealth', 'labor' ];
		    for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
			    if (id === 'wealth') {
				    link.id = 'wealth-button';
			    }
			    else if (id === 'community') {
				    link.id = 'community-button';
			    }
			    else {
				    link.id = 'labor-button';
			    }
    link.className = 'active';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
                  var places = [{
	"name": "Trefriw Woolen Mills",
	"description": "This is one of the few remaining mills in the area. It opened in the 1820s and has been owned by the same family since 1859.",
	"latitude": 53.151260,
	"longitude": -3.824624,
	"url": "http://www.t-w-m.co.uk/",
	"category": "labor"
}, {
	"name": "Bodnant Gardens",
	"description": " Part of the Bodnant Estate, it is an 80-acre garden located above the Conwy River and is owned by the National Trust. Currently, it is a tourist site in conjunction to a restaurant that specializes in Welsh cuisine and the Hall (whic is still privately owned).",
	"latitude": 53.235047,
	"longitude": -3.799055,
	"url": "https://www.nationaltrust.org.uk/bodnant-garden",
	"category": "wealth"
}, {
	"name": "Portmeirion Village and Gardens",
	"description": "This Italian style village was built in the 1920s to be a sea-side resort town. Clough Williams-Ellis was the owner and architect. His mother was the daughter of a Blaenau-Ffestiniog slate mine owner. It was not completed until the 1970s.",
	"latitude": 52.913533,
	"longitude": -4.098928,
	"url": "http://www.portmeirion-village.com/",
	"category": "wealth"
}, {
	"name": "Snowdon Inn",
	"description": "This current gathering spot and inn is located right next to Craig-yr-undeb (Union Rock)",
	"latitude": 53.138267,
	"longitude": -4.156118,
	"url": "http://www.thesnowdoninn.co.uk/",
	"category": "community"
}, {
	"name": "Vaynol Estate",
	"description": "Assheton-Smith family, who owned Dinorwyg quarry, built this estate.",
	"latitude": 53.201859,
	"longitude": -4.191840,
	"url": "http://www.jaggers-heritage.com/resources/Section%2019.pdf",
	"category": "wealth"
}, {
	"name": "Penrhyn Castle",
	"description": "The Penrhyn family owned of the Penrhyn Quarry. The estate was built in the late 19th century after the family took the wealth thay made from the slave trade and put it into the quarry.",
	"latitude": 53.225759,
	"longitude": -4.094692,
	"url": "https://www.nationaltrust.org.uk/penrhyn-castle",
	"category": "wealth"
}, {
	"name": "Craig-yr-undeb",
	"description": "Union Rock: this is the meeting location for the workers in Llanberys quarry to form the union; it wasn't safe to meet in the quarry, so they meet at this rock.",
	"latitude": 53.136813,
	"longitude": -4.152998,
	"url": "http://historypoints.org/index.php?page=craig-yr-undeb-brynrefail",
	"category": "labor"
}, {
	"name": "Llanberys",
	"description": " A former slate quarry town, it is a tourist town for climbers and those riding the local, historic trains.",
	"latitude": 53.004620,
	"longitude": -3.940245,
	"url": "http://www.llechwedd-slate-caverns.co.uk/",
	"category": "labor"
}, {
	"name": "Caban",
	"description": "A former school house that has been converted into a an art and cultural center. It has a lovely restaurant with locally grown foods.",
	"latitude": 53.142359,
	"longitude": -4.154067,
	"url": "http://caban-cyf.org/",
	"category": "community"
}, {
	"name": "Royal Cambrian Academy of Art",
	"description": "This is the home of the first artists colony in Britian and it attracted many artists to the community. In 1881, it was at its peak of fame and Queen Victoria officially created the Royal Cambrian Academy of Art based on it.",
	"latitude": 53.281471,
	"longitude": -3.830214,
	"url": "http://rcaconwy.org/",
	"category": "community"
}, {
	"name": "Castell Caernarfon",
	"description": "It is a medievel castle that was established in 1283 by King Edward I of England following his conquest of Gwynedd and it was one of a ring of castles built from local slate to maintain English rule in the area.",
	"latitude": 53.139107,
	"longitude": -4.276887,
	"url": "http://cadw.gov.wales/daysout/caernarfon-castle/?lang=en",
	"category": "community"
}, {
	"name": "Dinorwyg",
	"alt": " Anglicized as Dinorwyc",
	"description": "This is a former quarry. It is now a the hydroelectric plant and tourist location. ",
	"latitude": 53.134038,
	"longitude": -4.113916,
	"url": "https://museum.wales/427/",
	"category": "labor"
}, {
	"name": "Penrhyn",
	"description": "This is the quarry that had the longest labor dispute. It lasted for 3 years: from 1900-1903.",
	"latitude": 53.232973,
	"longitude": -4.110179,
	"url": "http://www.snowdoniaheritage.info/en/location/361/penrhyn-quarry/",
	"category": "labor"
}, {
	"name": "Blaenau Ffestiniog",
	"description": "It was one of the major slate mines from the region. It is now a tourist site.",
	"latitude": 52.998346,
	"longitude": -3.944913,
	"url": "http://www.blaenauffestiniog.org/",
	"category": "labor"
}, {
	"name": "Sygun Copper Mine",
	"latitude": 53.018578,
	"longitude": -4.081890,
	"description": "Unlike the other local mines, this one was not for slate but copper. It closed in 1903 and reopened in 1986 as a tourist attraction that includes a museum and art gallery.",
	"url": "http://www.syguncoppermine.co.uk/",
	"category": "labor"
}, {
	"name": "Ffestiniog",
	"description": "This town is famous for its railways that were the old quarry railways.",
	"latitude": 52.994605,
	"longitude": -3.938312,
	"url": "http://www.festrail.co.uk/",
	"category": "labor"
}, {
	"name": "Y Felinheli",
	"alt": "Anglicized as Port Dinorwic",
	"description": "It was the port that transported the slate from the Dinorwyg mines to other parts of the U.K. and overseas.",
	"url": "http://www.felinheli.org/eng/",
	"latitude": 53.181240,
	"longitude": -4.212620,
	"category": "labor"
}, {
	"name": "Nant Lle Quarry",
	"description": "It was a major slate quarry for the area.The slate from this quarry was sent out through the Caernarfon harbor.",
	"latitude": 53.057526,
	"longitude": -4.222792,
	"url": "http://www.nantlle.com/history-nantlle.htm",
	"category": "labor"
}];
                  var thesePlacesGeoJSON = [];
                  function getIconFromCategory (categoryString) {
                        switch (categoryString) {
                              case 'wealth':
                                    return '/UK/bank-15.svg'
                              case 'community':
                                    return '/UK/town-hall-15.svg'
                              case 'labor':
                                    return '/UK/industry-15.svg'
                              default:
                                    return 'bar'
                        }
                  };
                  function onEachFeature(feature, layer) { 
                        if (feature.properties && feature.properties.popupContent) { 
                              layer.bindPopup(feature.properties.popupContent); 
                        } 
                  };
                  for (var i = 0; i < places.length; i++ ) {
                              var place = places[i];
                              thisPlaceGeoJSON = {
                                    type: 'Feature',
                                    geometry: {
                                          type: 'Point',
                                          coordinates: [
                                                place.longitude, 
                                                place.latitude
                                          ]
                                    },
                                    properties: {
					    href: place.url,
					    title: place.name,
					    description: place.description,
					    icon: {
						    iconUrl: getIconFromCategory(place.category),
						    iconSize: [50, 50],
                                                iconAnchor: [25, 25],
                                                popupAnchor: [0, -25],
                                                className: classifyCategories(place.category)
                                          },
                                          popupContent: place.description
                                    }
                              }
                        thesePlacesGeoJSON.push(thisPlaceGeoJSON);
                  }
//                   var xhr = new XMLHttpRequest();
//                   xhr.onreadystatechange = function() {
//                         var places = JSON.parse(this.responseText);
//                         for (var i = 0; i < places.length; i++ ) {
//                               var place = places[i];
//                               thisPlaceGeoJSON = {
//                                     title: place.name,
//                                     description: place.description,
//                                     type: 'Feature',
//                                     geometry: {
//                                           type: 'Point',
//                                           coordinates: [
//                                                 place.longitude, 
//                                                 place.latitude
//                                           ]
//                                     },
//                                     properties: {
//                                           icon: {
//                                                 iconUrl: getIconFromCategory(place.category),
//                                                 iconSize: [50, 50],
//                                                 iconAnchor: [25, 25],
//                                                 popupAnchor: [0, -25],
//                                                 className: 'place'
//                                           },
//                                           popupContent: place.description
//                                     }
//                               }
//                               thesePlacesGeoJSON.push(thisPlaceGeoJSON);
//                         }
//                   };
//                   xhr.open("GET", "https://mappingmemory.github.io/UK/places.json");
//                   xhr.send();
                  myLayer.on('layeradd', function(e) {
                        var marker = e.layer;
                        var feature = marker.feature;
                        var content = '<h2>' + feature.properties.title + '</h2><p>' + feature.properties.description + '</p><p>For more information visit <a href="' + feature.properties.href + '">here.</a>';
                        marker.bindPopup(content);
                        marker.setIcon(L.icon(feature.properties.icon));
                        
                  });
                  myLayer.setGeoJSON(thesePlacesGeoJSON, { 
                                    onEachFeature: onEachFeature 
                              }).addTo(map);
                  setTimeout(function() {
                        myLayer.setGeoJSON(thesePlacesGeoJSON);
                  }, 500)
</script>
</body>
</html>
